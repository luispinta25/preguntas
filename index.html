<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>INKA CORP – Levantamiento de Requisitos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Librerías -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background:#f4f6fb;
    color:#1a1a1a;
  }

  .container{
    max-width:1200px;
    margin:auto;
    padding:40px 24px;
  }

  h1{
    margin:0 0 10px;
    font-size:26px;
  }

  .center{
    text-align:center;
  }

  textarea{
    width:100%;
    height:60vh;
    padding:20px;
    font-size:14px;
    border-radius:10px;
    border:1px solid #ccc;
    resize:none;
  }

  button{
    padding:12px 20px;
    border-radius:8px;
    border:none;
    font-weight:600;
    cursor:pointer;
    background:#1f4cff;
    color:white;
  }

  button.secondary{
    background:#e5e7eb;
    color:#111;
  }

  button.danger{
    background:#dc2626;
  }

  .actions{
    display:flex;
    gap:12px;
    margin-top:20px;
    flex-wrap:wrap;
  }

  .hidden{
    display:none;
  }

  .question{
    border-bottom:1px solid #e5e7eb;
    padding:16px 0;
  }

  .question p{
    margin:0 0 8px;
    font-weight:600;
  }

  .question textarea{
    height:70px;
    font-size:14px;
  }

  /* PDF area */
  #pdfArea{
    position:fixed;
    left:-9999px;
    width:794px;
    background:white;
    padding:40px;
    font-family: Arial;
  }

  #pdfArea h1{
    font-size:18px;
    margin-bottom:10px;
  }

  #pdfArea .item{
    margin-bottom:14px;
  }

  #pdfArea .q{
    font-weight:bold;
    font-size:12px;
  }

  #pdfArea .a{
    font-size:12px;
    white-space:pre-wrap;
    margin-top:4px;
  }
</style>
</head>

<body>

<div class="container" id="screenEditor">
  <div class="center">
    <h1>Inserta el markdown aquí</h1>
    <p>Pega el cuestionario en formato Markdown</p>
  </div>

  <textarea id="mdInput" placeholder="# Preguntas&#10;1. ¿Ejemplo?"></textarea>

  <div class="center">
    <button onclick="generarFormulario()">Generar formulario</button>
  </div>
</div>

<div class="container hidden" id="screenForm">
  <h1>Formulario de respuestas</h1>

  <div id="formulario"></div>

  <div class="actions">
    <button onclick="generarPDF()">Generar PDF</button>
    <button class="secondary" onclick="reiniciar()">Regresar al inicio</button>
    <button class="danger" onclick="limpiar()">Limpiar</button>
  </div>
</div>

<div id="pdfArea"></div>

<script>
let preguntas = [];

function generarFormulario(){
  const md = document.getElementById("mdInput").value;
  const lines = md.split(/\r?\n/);

  preguntas = [];
  for(const l of lines){
    const m = l.match(/^\s*\d+\.\s+(.*)$/);
    if(m) preguntas.push(m[1]);
  }

  if(!preguntas.length){
    alert("No se detectaron preguntas numeradas");
    return;
  }

  const cont = document.getElementById("formulario");
  cont.innerHTML = "";

  preguntas.forEach((p,i)=>{
    cont.innerHTML += `
      <div class="question">
        <p>${i+1}. ${p}</p>
        <textarea data-i="${i}" placeholder="Respuesta..."></textarea>
      </div>
    `;
  });

  document.getElementById("screenEditor").classList.add("hidden");
  document.getElementById("screenForm").classList.remove("hidden");
}

function generarPDF(){
  const pdfArea = document.getElementById("pdfArea");
  const answers = document.querySelectorAll("#formulario textarea");

  let html = `<h1>INKA CORP – Respuestas</h1><p>Fecha: ${new Date().toLocaleString()}</p>`;

  answers.forEach((a,i)=>{
    html += `
      <div class="item">
        <div class="q">${i+1}. ${preguntas[i]}</div>
        <div class="a">${a.value || "(Sin respuesta)"}</div>
      </div>
    `;
  });

  pdfArea.innerHTML = html;

  html2canvas(pdfArea,{scale:2}).then(canvas=>{
    const img = canvas.toDataURL("image/png");
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p","pt","a4");

    const w = pdf.internal.pageSize.getWidth();
    const h = canvas.height * w / canvas.width;

    let y = 0;
    pdf.addImage(img,"PNG",0,y,w,h);

    while(h + y > pdf.internal.pageSize.getHeight()){
      y -= pdf.internal.pageSize.getHeight();
      pdf.addPage();
      pdf.addImage(img,"PNG",0,y,w,h);
    }

    pdf.save("INKA_CORP_Respuestas.pdf");
  });
}

function limpiar(){
  document.querySelectorAll("#formulario textarea").forEach(t=>t.value="");
}

function reiniciar(){
  document.getElementById("mdInput").value="";
  document.getElementById("screenForm").classList.add("hidden");
  document.getElementById("screenEditor").classList.remove("hidden");
}
</script>

</body>
</html>
